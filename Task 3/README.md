# Проблемы и риски текущего решения

1. Проблемы с синхронными запросами:
- Сервисы core-app и ins-comp-settlement используют синхронные REST-запросы к ins-product-aggregator, что может приводить к задержкам и ошибкам, особенно при увеличении количества страховых компаний.
- Запросы к страховым компаниям выполняются синхронно, что увеличивает время ответа и вероятность сбоев.

2. Риски при увеличении нагрузки:
- Увеличение количества страховых компаний с 5 до 10 приведёт к росту нагрузки на ins-product-aggregator, что может вызвать таймауты и ошибки.

3. Проблемы с актуальностью данных:
- Данные в локальных БД core-app и ins-comp-settlement могут быть неактуальными, так как обновляются с задержкой.
- Разница в частоте обновления данных между сервисами может привести к несогласованности.

4. Надёжность взаимодействия:
- Ошибки при взаимодействии с API страховых компаний могут привести к частичной или полной недоступности данных.
- Отсутствие механизма повторных попыток или отложенной обработки запросов.

5. Масштабируемость:
- При увеличении количества экземпляров core-app и ins-comp-settlement увеличится нагрузка на ins-product-aggregator, что может привести к сильной нагрузке на ins-product-aggregator.
- Отсутствие очередей или брокеров сообщений для асинхронной обработки запросов.


# Предлагаемые решения

1. Переход на Event-Streaming:
- Заменить синхронные REST-запросы на асинхронное взаимодействие через брокер сообщений (например, Kafka или RabbitMQ).
- Сервис ins-product-aggregator будет публиковать обновления данных о продуктах в нужные топик, а core-app и ins-comp-settlement — подписываться на обновления этих топиков.
Это снизит нагрузку на ins-product-aggregator и устранит проблемы с задержками.

2. Использование паттерна Transactional Outbox:
- Для обеспечения надёжности передачи данных между сервисами можно применить паттерн Transactional Outbox. Например, при оформлении страховки в core-app данные будут сохраняться в локальную БД и в Outbox-таблицу, откуда их будет забирать и публиковать отдельный процесс. Это будет гарантировать, что сервис ins-comp-settlement получит сообщение о страховке и только один раз.
